<?php

namespace SFR\Providers;

class MigrationsProvider extends ServiceProvider {

    /**
     * Holds the list of migrations to be run.
     * This could be autogenerated based on the files in the directory, 
     * however that comes with a filesystem performance penalty, and these 
     * migrations ideally run only once, so that would be a pointless use
     * of resources.
     *
     * @var array
     */
    private $migrations = [
        \SFR\Database\Migrations\LogTable::class
    ];

    public function run() {
        if( !is_admin() ) {
            return;
        }

        if( defined( 'SFR_ENABLE_DATASTORE' ) && SFR_ENABLE_DATASTORE ) {
            \SFR\Database\Migrations\WordPressTables::run();
        } 

        foreach($this->migrations as $migration) {
            try {
                $migration::run();
            } catch(\Exception $e) {
                \SFR\Models\Log::error('load_migration', 'Unable to locate migration: ' . $migration);
            }
        }
    }
}